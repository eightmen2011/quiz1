<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, user-scalable=yes">
<title>検索</title>
<link rel="apple-touch-icon" sizes="1024x1024" href="./icon.png">
<link rel="icon" type="image/x-icon" href="./favicon.ico">
<link rel="stylesheet" type="text/css" href="style.css">
<style>
.tabArea{
  margin-bottom:15px;
}
.tab{
  padding:10px 20px;
  border:none;
  border-radius:10px;
  margin:0 5px;
  cursor:pointer;
  font-size:15px;
}
.active{
  background:#191970;
  color:white;
}
.inactive{
  background:#ddd;
}

input{
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:14px;
  width:60%;
  max-width:300px;
}

.card{
  background:white;
  padding:20px;
  border-radius:12px;
  margin-bottom:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.title{
  font-size:18px;
  font-weight:bold;
}
.owner{
  color:#666;
  font-size:13px;
}
.count{
  font-size:13px;
  color:#333;
}
</style>
</head>
<body>

<header>
  <p class="headertitle"><a href="index.html">Vocaboost</a></p>
</header>

<main>
  <div class="tabArea">
    <button id="bookTab" class="tab active" onclick="showBooks()">単語帳</button>
    <button id="userTab" class="tab inactive" onclick="showUsers()">ユーザー</button>
  </div>

  <input id="search" placeholder="検索" oninput="render()"><br><br>

  <div id="list"></div>
</main>

<footer>
  <div class="footer-inner">
    <div>Vocaboost</div>
    <div class="footer-links">
      <a href="index.html">ホーム</a>
      <a href="list.html">検索</a>
      <a href="create.html">作成</a>
      <a href="mypage.html">マイページ</a>
      <a href="update.html">更新履歴</a>
    </div>
    <div class="copy">© 2026 Wordbook App</div>
  </div>
</footer>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD7CJmO3eAO0o2EPRDsVqTtZ_whRd_3-3E",
  authDomain: "quiz1-4ffdc.firebaseapp.com",
  projectId: "quiz1-4ffdc",
  storageBucket: "quiz1-4ffdc.firebasestorage.app",
  messagingSenderId: "152062126332",
  appId: "1:152062126332:web:845af237a1a76207214f79"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

let mode="book"; // book / user
let books=[];
let users=[];

async function load(){
  // 公開単語帳
  const snap = await db.collection("wordbooks")
    .where("isPublic","==",true)
    .get();

  books = [];
  for(const d of snap.docs){
    const wordSnap = await db.collection("wordbooks").doc(d.id).collection("words").get();
    books.push({
      id:d.id,
      title:d.data().title,
      ownerName:d.data().ownerName || "不明",
      count: wordSnap.size
    });
  }

  // users
  const snapUsers = await db.collection("users").get();
  users = snapUsers.docs.map(d=>({
    id:d.id,
    username:d.data().username || ""
  }));

  render();
}

function showBooks(){
  mode="book";
  document.getElementById("bookTab").className="tab active";
  document.getElementById("userTab").className="tab inactive";
  render();
}

function showUsers(){
  mode="user";
  document.getElementById("bookTab").className="tab inactive";
  document.getElementById("userTab").className="tab active";
  render();
}

function render(){
  const q=document.getElementById("search").value.toLowerCase();
  const area=document.getElementById("list");
  area.innerHTML="";

  if(mode==="book"){
    books.filter(b=>b.title.toLowerCase().includes(q)).forEach(b=>{
      const div=document.createElement("div");
      div.className="card";
      div.innerHTML=`
        <div>
          <div class="title">${b.title}</div>
          <div class="owner">作成者：${b.ownerName}</div>
          <div class="count">単語数：${b.count}</div>
        </div>
        <button onclick="location.href='view.html?id=${b.id}'">開く</button>
      `;
      area.appendChild(div);
    });
  }else{
    users.filter(u=>u.username.toLowerCase().includes(q)).forEach(u=>{
      const div=document.createElement("div");
      div.className="card";
      div.innerHTML=`
        <div class="title">${u.username}</div>
        <button onclick="location.href='user.html?id=${u.id}'">見る</button>
      `;
      area.appendChild(div);
    });
  }
}

load();
</script>

</body>
</html>
