<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>æ–°è¦ç™»éŒ²</title>
<link rel="stylesheet" type="text/css" href="style.css">
<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#eef2ff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.card{
  background:white;
  padding:30px;
  border-radius:15px;
  width:320px;
  text-align:center;
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
}

input{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:16px;
  margin-top:10px;
}

button{
  background:#4f7cff;
  color:white;
  border:none;
  border-radius:10px;
  padding:10px;
  width:100%;
  margin-top:15px;
  font-size:16px;
  cursor:pointer;
}

.notice{
  color:red;
  margin-top:10px;
}

.domain{
  margin-top:5px;
  font-size:14px;
  color:#555;
}

.link{
  margin-top:15px;
}
</style>
</head>
<body>

<div class="card">

<h2>æ–°è¦ç™»éŒ²</h2>

<input id="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å">

<input id="emailHead" placeholder="ãƒ¡ãƒ¼ãƒ«">
<div class="domain">@edu.nishiyamato.ed.jp</div>

<input id="password" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">

<button onclick="register()">ç™»éŒ²</button>

<div class="notice" id="msg"></div>

<div class="link">
  ã™ã§ã«ç™»éŒ²æ¸ˆã¿ã®æ–¹ã¯  
  <a href="login.html">ãƒ­ã‚°ã‚¤ãƒ³</a>
</div>

</div>


<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>

const firebaseConfig = {
  apiKey: "AIzaSyD7CJmO3eAO0o2EPRDsVqTtZ_whRd_3-3E",
  authDomain: "quiz1-4ffdc.firebaseapp.com",
  projectId: "quiz1-4ffdc"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

async function register(){

  const username = document.getElementById("username").value.trim();
  const head = document.getElementById("emailHead").value.trim();
  const pass = document.getElementById("password").value;
  const msg = document.getElementById("msg");

  msg.textContent = "";

  // å…¥åŠ›ãƒã‚§ãƒƒã‚¯
  if(!username || !head || !pass){
    msg.textContent = "ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„";
    return;
  }

  const email = head + "@edu.nishiyamato.ed.jp";

  try{

    // ğŸ”¹Authç™»éŒ²
    const userCredential =
      await auth.createUserWithEmailAndPassword(email,pass);

    const user = userCredential.user;

    // ğŸ”¹Authã«usernameä¿å­˜
    await user.updateProfile({
      displayName: username
    });

    // ğŸ”¹Firestoreã«ä¿å­˜
    await db.collection("users").doc(user.uid).set({
      email: email,
      username: username,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    alert("ç™»éŒ²å®Œäº†ã—ã¾ã—ãŸï¼");
    location.href="login.html";

  }catch(e){
    msg.textContent = "ç™»éŒ²å¤±æ•—ï¼š" + e.message;
  }

}

</script>

</body>
</html>
