<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, user-scalable=yes">
<title>æ–°è¦ç™»éŒ²</title>
<link rel="stylesheet" type="text/css" href="style.css">
<link rel="stylesheet" type="text/css" href="login.css">
</head>
<body>
<div class="card">
<h2>æ–°è¦ç™»éŒ²</h2>
<input id="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å">

<div class="mailaddress">
    <input id="emailHead" placeholder="ãƒ¡ãƒ¼ãƒ«">
    <div class="domain">@edu.nishiyamato.ed.jp</div>
</div>
<input id="password" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">

<button onclick="register()">ç™»éŒ²</button>

<div class="notice" id="msg"></div>

<div class="link">
  ã™ã§ã«ç™»éŒ²æ¸ˆã¿ã®æ–¹ã¯  
  <a href="login.html">ãƒ­ã‚°ã‚¤ãƒ³</a>
</div>

</div>


<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>

const firebaseConfig = {
  apiKey: "AIzaSyD7CJmO3eAO0o2EPRDsVqTtZ_whRd_3-3E",
  authDomain: "quiz1-4ffdc.firebaseapp.com",
  projectId: "quiz1-4ffdc"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

async function register(){

  const username = document.getElementById("username").value.trim();
  const head = document.getElementById("emailHead").value.trim();
  const pass = document.getElementById("password").value;
  const msg = document.getElementById("msg");

  msg.textContent = "";

  // å…¥åŠ›ãƒã‚§ãƒƒã‚¯
  if(!username || !head || !pass){
    msg.textContent = "ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„";
    return;
  }

  const email = head + "@edu.nishiyamato.ed.jp";

  try{

    // ğŸ”¹Authç™»éŒ²
    const userCredential =
      await auth.createUserWithEmailAndPassword(email,pass);

    const user = userCredential.user;

    // ğŸ”¹Authã«usernameä¿å­˜
    await user.updateProfile({
      displayName: username
    });

    // ğŸ”¹Firestoreã«ä¿å­˜
    await db.collection("users").doc(user.uid).set({
      email: email,
      username: username,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    alert("ç™»éŒ²å®Œäº†ã—ã¾ã—ãŸï¼");
    location.href="login.html";

  }catch(e){
    msg.textContent = "ç™»éŒ²å¤±æ•—ï¼š" + e.message;
  }

}

</script>

</body>
</html>
