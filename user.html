<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, user-scalable=yes">
<title>ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±</title>
<link rel="apple-touch-icon" sizes="1024x1024" href="./icon.png">
<link rel="icon" type="image/x-icon" href="./favicon.ico">
<link rel="stylesheet" type="text/css" href="style.css">
<style>
.card{
  background:white;
  padding:25px;
  border-radius:12px;
  margin-bottom:20px;
}
.wordbook{
  padding:10px;
  border-bottom:1px solid #ddd;
  display:flex;
  justify-content:space-between;
}
a{
  text-decoration:none;
  color:#191970;
  font-weight:bold;
}

html, body{
  height:100%;
  margin:0;
}
body{
  display:flex;
  flex-direction:column;
}
main{
  flex:1;
}

</style>
</head>
<body>

<header>
  <p class="headertitle"><a href="index.html">å˜èªå¸³ã‚¢ãƒ—ãƒª</a></p>
</header>

<main>
  <div class="card">
    <h2>ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±</h2>
    <p id="userNameText">èª­ã¿è¾¼ã¿ä¸­...</p>
  </div>

  <div class="card">
    <h3>ğŸ“š å…¬é–‹ã—ã¦ã„ã‚‹å˜èªå¸³</h3>
    <div id="bookList"></div>
  </div>
</main>

<footer>
  <div class="footer-inner">
    <div>ğŸ“˜ å˜èªå¸³ã‚¢ãƒ—ãƒª</div>
    <div class="footer-links">
      <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
      <a href="list.html">å…¬é–‹å˜èªå¸³</a>
      <a href="create.html">ä½œæˆ</a>
      <a href="mypage.html">ãƒã‚¤ãƒšãƒ¼ã‚¸</a>
      <a href="update.html">æ›´æ–°å±¥æ­´</a>
    </div>
    <div class="copy">Â© 2026 Wordbook App</div>
  </div>
</footer>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD7CJmO3eAO0o2EPRDsVqTtZ_whRd_3-3E",
  authDomain: "quiz1-4ffdc.firebaseapp.com",
  projectId: "quiz1-4ffdc",
  storageBucket: "quiz1-4ffdc.firebasestorage.app",
  messagingSenderId: "152062126332",
  appId: "1:152062126332:web:845af237a1a76207214f79"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const params = new URLSearchParams(location.search);
const uid = params.get("id");

const userNameText = document.getElementById("userNameText");
const headerName = document.getElementById("username");
const bookList = document.getElementById("bookList");

if(!uid){
  userNameText.textContent = "ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒã‚ã‚Šã¾ã›ã‚“";
  throw new Error("uid missing");
}

async function loadUser(){
  try{
    const userDoc = await db.collection("users").doc(uid).get();

    if(!userDoc.exists){
      userNameText.textContent = "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“";
      return;
    }

    const userData = userDoc.data();
    const username = userData.username || "åç„¡ã—";

    userNameText.textContent = "ãƒ¦ãƒ¼ã‚¶ãƒ¼å: " + username;
    headerName.textContent = "ğŸ‘¤ " + username;

    loadBooks(username);

  }catch(e){
    userNameText.textContent = "èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼";
    console.error(e);
  }
}

async function loadBooks(username){
  const snap = await db.collection("wordbooks")
    .where("ownerName","==",username)
    .where("isPublic","==",true)
    .get();

  if(snap.empty){
    bookList.innerHTML = "<p>å…¬é–‹å˜èªå¸³ã¯ã‚ã‚Šã¾ã›ã‚“</p>";
    return;
  }

  snap.forEach(doc=>{
    const b = doc.data();
    const div = document.createElement("div");
    div.className = "wordbook";
    div.innerHTML = `
      <span>${b.title}</span>
      <a href="view.html?id=${doc.id}">é–‹ã</a>
    `;
    bookList.appendChild(div);
  });
}

loadUser();
</script>

</body>
</html>
