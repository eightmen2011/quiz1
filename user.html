<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, user-scalable=yes">
<title>ユーザー情報</title>
<link rel="apple-touch-icon" sizes="1024x1024" href="./icon.png">
<link rel="icon" type="image/x-icon" href="./favicon.ico">
<link rel="stylesheet" type="text/css" href="style.css">
<style>
.card{
  background:white;
  padding:25px;
  border-radius:12px;
  margin-bottom:20px;
}
.wordbook{
  padding:10px;
  border-bottom:1px solid #ddd;
  display:flex;
  justify-content:space-between;
}
a{
  text-decoration:none;
  color:#191970;
  font-weight:bold;
}

html, body{
  height:100%;
  margin:0;
}
body{
  display:flex;
  flex-direction:column;
}
main{
  flex:1;
}

</style>
</head>
<body>

<header>
  <div class="headertitle"><a href="index.html"><img src="./headerrogo.png" height="45px"></a></div>
</header>

<main>
  <div class="card">
    <h2>ユーザー情報</h2>
    <p id="userNameText">読み込み中...</p>
  </div>

  <div class="card">
    <h3>公開している単語帳</h3>
    <div id="bookList"></div>
  </div>
</main>

<footer>
  <div class="footer-inner">
    <div>Vocaboost</div>
    <div class="footer-links">
      <a href="index.html">ホーム</a>
      <a href="list.html">公開単語帳</a>
      <a href="create.html">作成</a>
      <a href="mypage.html">マイページ</a>
      <a href="update.html">更新履歴</a>
    </div>
    <div class="copy">© 2026 Wordbook App</div>
  </div>
</footer>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD7CJmO3eAO0o2EPRDsVqTtZ_whRd_3-3E",
  authDomain: "quiz1-4ffdc.firebaseapp.com",
  projectId: "quiz1-4ffdc",
  storageBucket: "quiz1-4ffdc.firebasestorage.app",
  messagingSenderId: "152062126332",
  appId: "1:152062126332:web:845af237a1a76207214f79"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const params = new URLSearchParams(location.search);
const uid = params.get("id");

const userNameText = document.getElementById("userNameText");
const headerName = document.getElementById("username");
const bookList = document.getElementById("bookList");

if(!uid){
  userNameText.textContent = "ユーザーIDがありません";
  throw new Error("uid missing");
}

async function loadUser(){
  try{
    const userDoc = await db.collection("users").doc(uid).get();

    if(!userDoc.exists){
      userNameText.textContent = "ユーザーが見つかりません";
      return;
    }

    const userData = userDoc.data();
    const username = userData.username || "名無し";

    userNameText.textContent = "ユーザー名: " + username;
    headerName.textContent = username;

    loadBooks(username);

  }catch(e){
    userNameText.textContent = "読み込みエラー";
    console.error(e);
  }
}

async function loadBooks(username){
  const snap = await db.collection("wordbooks")
    .where("ownerName","==",username)
    .where("isPublic","==",true)
    .get();

  if(snap.empty){
    bookList.innerHTML = "<p>公開単語帳はありません</p>";
    return;
  }

  snap.forEach(doc=>{
    const b = doc.data();
    const div = document.createElement("div");
    div.className = "wordbook";
    div.innerHTML = `
      <span>${b.title}</span>
      <a href="view.html?id=${doc.id}">開く</a>
    `;
    bookList.appendChild(div);
  });
}

loadUser();
</script>

</body>
</html>
