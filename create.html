<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å˜èªå¸³ä½œæˆ</title>
<link rel="stylesheet" type="text/css" href="style.css">
<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#eef2ff;
  min-height:100vh;
  display:flex;
  flex-direction:column;
}
header{
  background:#4f7cff;
  color:white;
  padding:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
main{
  max-width:800px;
  margin:30px auto;
  text-align:center;
  flex:1;
}
button{
  background:#4f7cff;
  color:white;
  border:none;
  border-radius:10px;
  padding:10px 18px;
  margin:10px;
  font-size:16px;
  cursor:pointer;
}
.card{
  background:white;
  padding:25px;
  border-radius:12px;
  margin-bottom:20px;
}
input{
  padding:12px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:16px;
  width:80%;
  max-width:400px;
}

.row{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:5px;
  margin-top:15px;
}

.wordRow{
  display:flex;
  justify-content:center;
  gap:10px;
  margin-top:10px;
}
.wordRow input{
  width:200px;
}

.list{
  margin-top:20px;
  text-align:left;
}
.wordItem{
  border-bottom:1px solid #ddd;
  padding:6px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.notice{
  color:red;
}
.smallBtn{
  background:#ff5c5c;
  border-radius:6px;
  padding:4px 8px;
  font-size:12px;
}

footer{
  background:#4f7cff;
  color:white;
  margin-top:40px;
  padding:20px 0;
}
.footer-inner{
  max-width:1000px;
  margin:auto;
  text-align:center;
}
.footer-links a{
  color:white;
  margin:0 10px;
  text-decoration:none;
  font-weight:bold;
}
.footer-links a:hover{
  text-decoration:underline;
}
.copy{
  font-size:12px;
  opacity:0.8;
}
</style>
</head>
<body>

<header>
  <div>â• å˜èªå¸³ä½œæˆ</div>
  <button onclick="location.href='index.html'">ãƒ›ãƒ¼ãƒ </button>
</header>

<main>

<div class="card">
  <h2>å˜èªå¸³æƒ…å ±</h2>
  <input id="title" placeholder="å˜èªå¸³ã‚¿ã‚¤ãƒˆãƒ«"><br>

  <div class="row">
    <label for="isPublic">å…¬é–‹ã™ã‚‹</label>
    <input type="checkbox" id="isPublic" checked>
  </div>

  <button onclick="createBook()">å˜èªå¸³ã‚’ä½œæˆ</button>
  <div id="msg" class="notice"></div>
</div>

<div class="card" id="wordArea" style="display:none">
  <h2>å˜èªã‚’è¿½åŠ </h2>

  <div class="wordRow">
    <input id="front" placeholder="ä¾‹ï¼šçŠ¬">
    <input id="back" placeholder="ä¾‹ï¼šdog">
  </div>

  <button onclick="addWord()">è¿½åŠ </button>

  <div class="list" id="wordList"></div>

  <hr>

  <h3>CSVæ“ä½œï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ï¼‰</h3>
  <input type="file" id="csvFile" accept=".csv,.txt"><br><br>

  <button onclick="importCSV()">CSVèª­ã¿è¾¼ã¿</button>
  <button onclick="exportCSV()">CSVæ›¸ãå‡ºã—</button>

  <br><br>
  <button onclick="goView()">å®Œæˆã—ã¦è¦‹ã‚‹</button>
</div>

</main>

<footer>
  <div class="footer-inner">
    <div>ğŸ“˜ å˜èªå¸³ã‚¢ãƒ—ãƒª</div>
    <div class="footer-links">
      <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
      <a href="list.html">å…¬é–‹å˜èªå¸³</a>
      <a href="create.html">ä½œæˆ</a>
      <a href="mypage.html">ãƒã‚¤ãƒšãƒ¼ã‚¸</a>
    </div>
    <div class="copy">Â© 2026 Wordbook App</div>
  </div>
</footer>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD7CJmO3eAO0o2EPRDsVqTtZ_whRd_3-3E",
  authDomain: "quiz1-4ffdc.firebaseapp.com",
  projectId: "quiz1-4ffdc",
  storageBucket: "quiz1-4ffdc.firebasestorage.app",
  messagingSenderId: "152062126332",
  appId: "1:152062126332:web:845af237a1a76207214f79"
};

firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();

let currentUser=null;
let bookId=null;

auth.onAuthStateChanged(user=>{
  if(user){
    currentUser=user;
  }else{
    alert("ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„");
    location.href="login.html";
  }
});

async function createBook(){
  const title=document.getElementById("title").value.trim();
  const isPublic=document.getElementById("isPublic").checked;
  const msg=document.getElementById("msg");

  if(!title){
    msg.textContent="ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„";
    return;
  }

  const doc = await db.collection("wordbooks").add({
    title:title,
    isPublic:isPublic,
    owner:currentUser.uid,
    ownerName:currentUser.displayName||"åç„¡ã—"
  });

  bookId = doc.id;
  document.getElementById("wordArea").style.display="block";
  msg.textContent="å˜èªå¸³ã‚’ä½œæˆã—ã¾ã—ãŸã€‚å˜èªã‚’è¿½åŠ ã—ã¦ãã ã•ã„";
}

async function addWord(){
  const f=document.getElementById("front").value.trim();
  const b=document.getElementById("back").value.trim();
  if(!f||!b||!bookId)return;

  const doc = await db.collection("wordbooks").doc(bookId).collection("words").add({
    front:f,
    back:b
  });

  addWordToList(doc.id,f,b);

  document.getElementById("front").value="";
  document.getElementById("back").value="";
}

function addWordToList(id,f,b){
  const div=document.createElement("div");
  div.className="wordItem";
  div.id="word_"+id;
  div.innerHTML=`${f} â†’ ${b}
    <button class="smallBtn" onclick="deleteWord('${id}')">å‰Šé™¤</button>`;
  document.getElementById("wordList").appendChild(div);
}

async function deleteWord(id){
  if(!confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
  await db.collection("wordbooks").doc(bookId).collection("words").doc(id).delete();
  document.getElementById("word_"+id).remove();
}

async function importCSV(){
  if(!bookId)return;

  const file=document.getElementById("csvFile").files[0];
  if(!file){
    alert("CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„");
    return;
  }

  const text = await file.text();
  const lines=text.split("\n");

  for(const line of lines){
    const [f,b]=line.split(",");
    if(f && b){
      const doc=await db.collection("wordbooks").doc(bookId).collection("words").add({
        front:f.trim(),
        back:b.trim()
      });
      addWordToList(doc.id,f.trim(),b.trim());
    }
  }

  document.getElementById("csvFile").value="";
}

async function exportCSV(){
  if(!bookId)return;

  const snap=await db.collection("wordbooks").doc(bookId).collection("words").get();
  let csv="";

  snap.forEach(d=>{
    const w=d.data();
    csv+=`${w.front},${w.back}\n`;
  });

  const blob=new Blob([csv],{type:"text/plain;charset=utf-8"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download="words.csv";
  a.click();
  URL.revokeObjectURL(url);
}

function goView(){
  location.href="view.html?id="+bookId;
}
</script>

</body>
</html>
